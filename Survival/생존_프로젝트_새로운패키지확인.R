# hw2_5?? S(x)?? ??��ġ?? ??????????��, ???̺Һ?????��?ؼ? ???? ?? KM ??��ġ?? ?????϶? 
# ?????????? ???̺Һ????? parametric -> mle?? ???? ?????? ???? ??��
# ?̴? lab3 ?????̵? 3?ʺ??? 11?ʱ??? ????

library(survival)
library(KMsurv)

data(drug6mp)
mp <- drug6mp

a <- Surv(time = mp$t2, event = mp$relapse)
a_fit <- survfit(formula = a ~1, data = a, conf.type = "plain")
plot(a_fit)
l <- sum(mp$relapse)/sum(mp$t2)
curve(exp(-l*x), from = 0, to = max(mp$t2) + 1, col = "blue", add = T)

a1 <- 1.4 # ????��?? ??�� ã��, ln_1??�� ???? ???ϰ?, lamda_1 ??�� ã�� ?? a?? ?????? ??�� ????
l1 <- sum(mp$relapse) / sum((mp$t2)^a1) # ??�� ??��?? ????
ln_1 <- log(a1*l1)*sum(mp$relapse) + (a1 - 1)*sum(log(mp$t2)*mp$relapse) - l1 * sum((mp$t2)^a1)
curve(exp(-l1*(x^a1)), from = 0, to = max(mp$t2) + 1, col = "red", add = T)

d <- fit_data(data = mp, dist = "exp", time = "t2", censor = "relapse")
l2 <- d$estimate
## 직접 계산 한 것과 결과 거의 동일
curve(exp(-l2*x), from = 0, to = max(mp$t2) + 1, col = "green", xlab = "Time", ylab = "Survival function", main = "L5_1 Using exponetial ditribution", add = T)

d1 <- fit_data(data = mp, dist = "weibull", time = "t2", censor = "relapse" )
a3 <- d1$estimate[1] ## alpha = shpae parameter
l4 <- sum(mp$relapse)/sum((mp$t2)^a3)
curve(exp(-l4*(x^a3)), from = 0, to = max(mp$t2) + 1, col = "blue", xlab = "Time", ylab = "Survival function", main = "L5_1 Using weibull ditribution", add = T)